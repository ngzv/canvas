<!doctype html>
<html lang="zh-CN">
  <head>
    <!-- 字符编码 -->
    <meta charset="UTF-8" />
    <!-- 安全相关 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <!-- 视口设置 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- 引入资源 -->
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <link rel="stylesheet" type="text/css" href="/css/ripple.css" />
    <!-- 页面标题 -->
    <title>Canvas</title>
  </head>
  <body>
    <noscript>
      <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #FFFFFF; display: flex; align-items: center; justify-content: center; z-index: 9999; text-align: center; padding: 20px;">
        <div>
          <h1 style="color: #333333; margin-bottom: 16px;">需要启用 JavaScript</h1>
          <p style="color: #666666; font-size: 18px;">很抱歉，应用程序需要启用 JavaScript 才能正常工作。请启用 JavaScript 后继续使用。</p>
        </div>
      </div>
    </noscript>
    <div id="app">
      <div id="launch">
        <!-- 加载动画容器 -->
        <div class="launch-loader">
          <span></span><span></span><span></span>
          <span></span><span></span><span></span>
          <span></span><span></span><span></span>
        </div>
        <p class="launch-text">资源正在加载中..</p>
      </div>
    </div>
    <script type="module" src="/src/main.js"></script>
    <script>
      // 加载动画处理脚本
      // 使用立即执行函数表达式(IIFE)避免全局变量污染
      (function() {
        // 定义事件处理函数
        function handleDOMContentLoaded() {
          // 使用let声明，允许重置引用
          let checkAppLoaded = null;
          let timeoutId = null;
          
          // 创建定时器检查应用加载状态
          checkAppLoaded = setInterval(() => {
            const app = document.getElementById('app');
            // 检查Vue应用是否已挂载
            if (app && app.children && app.children.length > 1) {
              cleanupResources();
            }
          }, 100);
          
          // 设置安全超时机制
          timeoutId = setTimeout(() => {
            cleanupResources();
          }, 6000);
          
          // 统一资源清理函数
          function cleanupResources() {
            // 清理所有定时器
            if (checkAppLoaded) {
              clearInterval(checkAppLoaded);
              checkAppLoaded = null;
            }
            
            if (timeoutId) {
              clearTimeout(timeoutId);
              timeoutId = null;
            }
            
            // 移除加载元素
            removeLaunchElement();
          }
          
          // 移除加载元素函数
          function removeLaunchElement() {
            const launch = document.getElementById('launch');
            if (launch && launch.parentNode) {
              // 添加淡出动画类
              launch.classList.add('loaded');
              
              // 动画完成后移除元素 - 使用300ms与CSS过渡效果匹配
              setTimeout(() => {
                if (launch && launch.parentNode) {
                  launch.parentNode.removeChild(launch);
                }
              }, 310);
            }
          }
          
          // 移除事件监听器，避免重复绑定
          document.removeEventListener('DOMContentLoaded', handleDOMContentLoaded);
        }
        
        // 绑定事件监听器
        document.addEventListener('DOMContentLoaded', handleDOMContentLoaded);
      })();
    </script>
  </body>
</html>